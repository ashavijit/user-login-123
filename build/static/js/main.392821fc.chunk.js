(this["webpackJsonpreact-recoil-registration-login-example"]=this["webpackJsonpreact-recoil-registration-login-example"]||[]).push([[0],{201:function(e,t,s){"use strict";s.r(t);var r=s(1),n=s.n(r),a=s(46),c=s.n(a),i=s(8),o=(s(97),s(11)),l=Object(i.b)({key:"alert",default:null}),d=Object(i.b)({key:"auth",default:JSON.parse(localStorage.getItem("user"))}),u=Object(i.b)({key:"users",default:null}),j=Object(i.b)({key:"user",default:null});function b(){var e=Object(i.f)(l);return{success:function(t){return e({message:t,type:"alert-success"})},error:function(t){return e({message:t,type:"alert-danger"})},clear:Object(i.e)(l)}}var m=s(2),O=s(4),h=s(7),f="react-recoil-registration-login-example-users",p=JSON.parse(localStorage.getItem(f))||[];var x=s(17),v=Object(x.a)();function N(){var e="".concat("http://localhost:4000","/users"),t=function(){var e=Object(i.c)(d),t=Object(O.a)(e,2),s=t[0],r=t[1],n=b();return{get:a("GET"),post:a("POST"),put:a("PUT"),delete:a("DELETE")};function a(e){return function(t,s){var r={method:e,headers:c(t)};return s&&(r.headers["Content-Type"]="application/json",r.body=JSON.stringify(s)),fetch(t,r).then(o)}}function c(e){var t=null===s||void 0===s?void 0:s.token,r=!!t,n=e.startsWith("http://localhost:4000");return r&&n?{Authorization:"Bearer ".concat(t)}:{}}function o(e){return e.text().then((function(t){var a=t&&JSON.parse(t);if(!e.ok){[401,403].includes(e.status)&&null!==s&&void 0!==s&&s.token&&(localStorage.removeItem("user"),r(null),v.push("/account/login"));var c=a&&a.message||e.statusText;return n.error(c),Promise.reject(c)}return a}))}}(),s=Object(i.c)(d),r=Object(O.a)(s,2),n=r[0],a=r[1],c=Object(i.f)(u),o=Object(i.f)(j);return{login:function(s){var r=s.username,n=s.password;return t.post("".concat(e,"/authenticate"),{username:r,password:n}).then((function(e){localStorage.setItem("user",JSON.stringify(e)),a(e);var t=(v.location.state||{from:{pathname:"/"}}).from;v.push(t)}))},logout:l,register:function(s){return t.post("".concat(e,"/register"),s)},getAll:function(){return t.get(e).then(c)},getById:function(s){return t.get("".concat(e,"/").concat(s)).then(o)},update:function(s,r){return t.put("".concat(e,"/").concat(s),r).then((function(e){if(s===(null===n||void 0===n?void 0:n.id)){var t=Object(m.a)(Object(m.a)({},n),r);localStorage.setItem("user",JSON.stringify(t)),a(t)}return e}))},delete:function(s){return c((function(e){return e.map((function(e){return e.id===s?Object(m.a)(Object(m.a)({},e),{},{isDeleting:!0}):e}))})),t.delete("".concat(e,"/").concat(s)).then((function(){c((function(e){return e.filter((function(e){return e.id!==s}))})),s===(null===n||void 0===n?void 0:n.id)&&l()}))},resetUsers:Object(i.e)(u),resetUser:Object(i.e)(j)};function l(){localStorage.removeItem("user"),a(null),v.push("/account/login")}}var g=s(0);function w(){var e=Object(i.d)(l),t=b();return Object(r.useEffect)((function(){return v.listen(t.clear)}),[]),e?Object(g.jsx)("div",{className:"container",children:Object(g.jsx)("div",{className:"m-3",children:Object(g.jsxs)("div",{className:"alert alert-dismissable ".concat(e.type),children:[Object(g.jsx)("a",{className:"close",onClick:t.clear,children:"\xd7"}),e.message]})})}):null}var y=s(15);function S(){var e=Object(i.d)(d),t=N();return e?Object(g.jsx)("nav",{className:"navbar navbar-expand navbar-dark bg-dark",children:Object(g.jsxs)("div",{className:"navbar-nav",children:[Object(g.jsx)(y.b,{exact:!0,to:"/",className:"nav-item nav-link",children:"Home"}),Object(g.jsx)(y.b,{to:"/users",className:"nav-item nav-link",children:"Users"}),Object(g.jsx)("a",{onClick:t.logout,className:"nav-item nav-link",children:"Logout"})]})}):null}var k=s(22),U=["component"];function q(e){var t=e.component,s=Object(k.a)(e,U),r=Object(i.d)(d);return Object(g.jsx)(o.b,Object(m.a)(Object(m.a)({},s),{},{render:function(e){return r?Object(g.jsx)(t,Object(m.a)({},e)):Object(g.jsx)(o.a,{to:{pathname:"/account/login",state:{from:e.location}}})}}))}function P(){var e=Object(i.d)(d);return Object(g.jsx)("div",{className:"p-4",children:Object(g.jsxs)("div",{className:"container",children:[Object(g.jsxs)("h1",{children:["Hi ",null===e||void 0===e?void 0:e.firstName,"!"]}),Object(g.jsx)("p",{children:"You're logged in with React + Recoil & JWT!!"}),Object(g.jsx)("p",{children:Object(g.jsx)(y.a,{to:"/users",children:"Manage Users"})})]})})}var E=s(21),J=s(33),T=s(16);function I(e){var t,s,n,a,c=e.history,o=e.match.params.id,l={add:!o,edit:!!o},d=N(),u=b(),O=Object(i.d)(j),h=T.a().shape({firstName:T.b().required("First Name is required"),lastName:T.b().required("Last Name is required"),username:T.b().required("Username is required"),password:T.b().transform((function(e){return""===e?void 0:e})).concat(l.add?T.b().required("Password is required"):null).min(6,"Password must be at least 6 characters")}),f={resolver:Object(J.a)(h)},p=Object(E.d)(f),x=p.register,v=p.handleSubmit,w=p.reset,S=p.formState,k=S.errors,U=S.isSubmitting;Object(r.useEffect)((function(){return l.edit&&d.getById(o),d.resetUser}),[]),Object(r.useEffect)((function(){l.edit&&O&&w(O)}),[O]);var q=l.edit&&!O;return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("h1",{children:l.add?"Add User":"Edit User"}),!q&&Object(g.jsxs)("form",{onSubmit:v((function(e){return l.add?function(e){return d.register(e).then((function(){c.push("/users"),u.success("User added")}))}(e):function(e,t){return d.update(e,t).then((function(){c.push("/users"),u.success("User updated")}))}(O.id,e)})),children:[Object(g.jsxs)("div",{className:"form-row",children:[Object(g.jsxs)("div",{className:"form-group col",children:[Object(g.jsx)("label",{children:"First Name"}),Object(g.jsx)("input",Object(m.a)(Object(m.a)({name:"firstName",type:"text"},x("firstName")),{},{className:"form-control ".concat(k.firstName?"is-invalid":"")})),Object(g.jsx)("div",{className:"invalid-feedback",children:null===(t=k.firstName)||void 0===t?void 0:t.message})]}),Object(g.jsxs)("div",{className:"form-group col",children:[Object(g.jsx)("label",{children:"Last Name"}),Object(g.jsx)("input",Object(m.a)(Object(m.a)({name:"lastName",type:"text"},x("lastName")),{},{className:"form-control ".concat(k.lastName?"is-invalid":"")})),Object(g.jsx)("div",{className:"invalid-feedback",children:null===(s=k.lastName)||void 0===s?void 0:s.message})]})]}),Object(g.jsxs)("div",{className:"form-row",children:[Object(g.jsxs)("div",{className:"form-group col",children:[Object(g.jsx)("label",{children:"Username"}),Object(g.jsx)("input",Object(m.a)(Object(m.a)({name:"username",type:"text"},x("username")),{},{className:"form-control ".concat(k.username?"is-invalid":"")})),Object(g.jsx)("div",{className:"invalid-feedback",children:null===(n=k.email)||void 0===n?void 0:n.message})]}),Object(g.jsxs)("div",{className:"form-group col",children:[Object(g.jsxs)("label",{children:["Password",l.edit&&Object(g.jsx)("em",{className:"ml-1",children:"(Leave blank to keep the same password)"})]}),Object(g.jsx)("input",Object(m.a)(Object(m.a)({name:"password",type:"password"},x("password")),{},{className:"form-control ".concat(k.password?"is-invalid":"")})),Object(g.jsx)("div",{className:"invalid-feedback",children:null===(a=k.password)||void 0===a?void 0:a.message})]})]}),Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsxs)("button",{type:"submit",disabled:U,className:"btn btn-primary mr-2",children:[U&&Object(g.jsx)("span",{className:"spinner-border spinner-border-sm mr-1"}),"Save"]}),Object(g.jsx)("button",{onClick:function(){return w(O)},type:"button",disabled:U,className:"btn btn-secondary",children:"Reset"}),Object(g.jsx)(y.a,{to:"/users",className:"btn btn-link",children:"Cancel"})]})]}),q&&Object(g.jsx)("div",{className:"text-center p-3",children:Object(g.jsx)("span",{className:"spinner-border spinner-border-lg align-center"})})]})}function L(e){var t=e.match.path,s=Object(i.d)(u),n=N();return Object(r.useEffect)((function(){return n.getAll(),n.resetUsers}),[]),Object(g.jsxs)("div",{children:[Object(g.jsx)("h1",{children:"Users"}),Object(g.jsx)(y.a,{to:"".concat(t,"/add"),className:"btn btn-sm btn-success mb-2",children:"Add User"}),Object(g.jsxs)("table",{className:"table table-striped",children:[Object(g.jsx)("thead",{children:Object(g.jsxs)("tr",{children:[Object(g.jsx)("th",{style:{width:"30%"},children:"First Name"}),Object(g.jsx)("th",{style:{width:"30%"},children:"Last Name"}),Object(g.jsx)("th",{style:{width:"30%"},children:"Username"}),Object(g.jsx)("th",{style:{width:"10%"}})]})}),Object(g.jsxs)("tbody",{children:[null===s||void 0===s?void 0:s.map((function(e){return Object(g.jsxs)("tr",{children:[Object(g.jsx)("td",{children:e.firstName}),Object(g.jsx)("td",{children:e.lastName}),Object(g.jsx)("td",{children:e.username}),Object(g.jsxs)("td",{style:{whiteSpace:"nowrap"},children:[Object(g.jsx)(y.a,{to:"".concat(t,"/edit/").concat(e.id),className:"btn btn-sm btn-primary mr-1",children:"Edit"}),Object(g.jsx)("button",{onClick:function(){return n.delete(e.id)},className:"btn btn-sm btn-danger",style:{width:"60px"},disabled:e.isDeleting,children:e.isDeleting?Object(g.jsx)("span",{className:"spinner-border spinner-border-sm"}):Object(g.jsx)("span",{children:"Delete"})})]})]},e.id)})),!s&&Object(g.jsx)("tr",{children:Object(g.jsx)("td",{colSpan:"4",className:"text-center",children:Object(g.jsx)("span",{className:"spinner-border spinner-border-lg align-center"})})})]})]})]})}function C(e){var t=e.match.path;return Object(g.jsx)("div",{className:"p-4",children:Object(g.jsx)("div",{className:"container",children:Object(g.jsxs)(o.d,{children:[Object(g.jsx)(o.b,{exact:!0,path:t,component:L}),Object(g.jsx)(o.b,{path:"".concat(t,"/add"),component:I}),Object(g.jsx)(o.b,{path:"".concat(t,"/edit/:id"),component:I})]})})})}function R(e){var t=e.history,s=e.match,n=Object(i.d)(d),a=s.path;return Object(r.useEffect)((function(){n&&t.push("/")}),[]),Object(g.jsx)("div",{className:"container",children:Object(g.jsx)("div",{className:"row",children:Object(g.jsx)("div",{className:"col-sm-8 offset-sm-2 mt-5",children:Object(g.jsxs)(o.d,{children:[Object(g.jsx)(o.b,{path:"".concat(a,"/login"),component:A}),Object(g.jsx)(o.b,{path:"".concat(a,"/register"),component:D})]})})})})}function A(){var e,t,s=N(),r=T.a().shape({username:T.b().required("Username is required"),password:T.b().required("Password is required")}),n={resolver:Object(J.a)(r)},a=Object(E.d)(n),c=a.register,i=a.handleSubmit,o=a.formState,l=o.errors,d=o.isSubmitting;return Object(g.jsxs)("div",{className:"card m-3",children:[Object(g.jsx)("h4",{className:"card-header",children:"Login"}),Object(g.jsx)("div",{className:"card-body",children:Object(g.jsxs)("form",{onSubmit:i(s.login),children:[Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsx)("label",{children:"Username"}),Object(g.jsx)("input",Object(m.a)(Object(m.a)({name:"username",type:"text"},c("username")),{},{className:"form-control ".concat(l.username?"is-invalid":"")})),Object(g.jsx)("div",{className:"invalid-feedback",children:null===(e=l.username)||void 0===e?void 0:e.message})]}),Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsx)("label",{children:"Password"}),Object(g.jsx)("input",Object(m.a)(Object(m.a)({name:"password",type:"password"},c("password")),{},{className:"form-control ".concat(l.password?"is-invalid":"")})),Object(g.jsx)("div",{className:"invalid-feedback",children:null===(t=l.password)||void 0===t?void 0:t.message})]}),Object(g.jsxs)("button",{disabled:d,className:"btn btn-primary",children:[d&&Object(g.jsx)("span",{className:"spinner-border spinner-border-sm mr-1"}),"Login"]}),Object(g.jsx)(y.a,{to:"register",className:"btn btn-link",children:"Register"})]})})]})}function D(e){var t,s,r,n,a=e.history,c=N(),i=b(),o=T.a().shape({firstName:T.b().required("First Name is required"),lastName:T.b().required("Last Name is required"),username:T.b().required("Username is required"),password:T.b().required("Password is required").min(6,"Password must be at least 6 characters")}),l={resolver:Object(J.a)(o)},d=Object(E.d)(l),u=d.register,j=d.handleSubmit,O=d.formState,h=O.errors,f=O.isSubmitting;return Object(g.jsxs)("div",{className:"card m-3",children:[Object(g.jsx)("h4",{className:"card-header",children:"Register"}),Object(g.jsx)("div",{className:"card-body",children:Object(g.jsxs)("form",{onSubmit:j((function(e){return c.register(e).then((function(){a.push("/account/login"),i.success("Registration successful")}))})),children:[Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsx)("label",{children:"First Name"}),Object(g.jsx)("input",Object(m.a)(Object(m.a)({name:"firstName",type:"text"},u("firstName")),{},{className:"form-control ".concat(h.firstName?"is-invalid":"")})),Object(g.jsx)("div",{className:"invalid-feedback",children:null===(t=h.firstName)||void 0===t?void 0:t.message})]}),Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsx)("label",{children:"Last Name"}),Object(g.jsx)("input",Object(m.a)(Object(m.a)({name:"lastName",type:"text"},u("lastName")),{},{className:"form-control ".concat(h.lastName?"is-invalid":"")})),Object(g.jsx)("div",{className:"invalid-feedback",children:null===(s=h.lastName)||void 0===s?void 0:s.message})]}),Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsx)("label",{children:"Username"}),Object(g.jsx)("input",Object(m.a)(Object(m.a)({name:"username",type:"text"},u("username")),{},{className:"form-control ".concat(h.username?"is-invalid":"")})),Object(g.jsx)("div",{className:"invalid-feedback",children:null===(r=h.username)||void 0===r?void 0:r.message})]}),Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsx)("label",{children:"Password"}),Object(g.jsx)("input",Object(m.a)(Object(m.a)({name:"password",type:"password"},u("password")),{},{className:"form-control ".concat(h.password?"is-invalid":"")})),Object(g.jsx)("div",{className:"invalid-feedback",children:null===(n=h.password)||void 0===n?void 0:n.message})]}),Object(g.jsxs)("button",{disabled:f,className:"btn btn-primary",children:[f&&Object(g.jsx)("span",{className:"spinner-border spinner-border-sm mr-1"}),"Register"]}),Object(g.jsx)(y.a,{to:"login",className:"btn btn-link",children:"Cancel"})]})})]})}function F(){var e=Object(i.d)(d);return Object(g.jsx)("div",{className:"app-container"+(e?" bg-light":""),children:Object(g.jsxs)(o.c,{history:v,children:[Object(g.jsx)(S,{}),Object(g.jsx)(w,{}),Object(g.jsxs)(o.d,{children:[Object(g.jsx)(q,{exact:!0,path:"/",component:P}),Object(g.jsx)(q,{path:"/users",component:C}),Object(g.jsx)(o.b,{path:"/account",component:R}),Object(g.jsx)(o.a,{from:"*",to:"/"})]})]})})}!function(){var e=window.fetch;window.fetch=function(t,s){return new Promise((function(r,n){function a(e){r({ok:!0,text:function(){return Promise.resolve(JSON.stringify(e))}})}function c(){r({status:401,text:function(){return Promise.resolve(JSON.stringify({message:"Unauthorized"}))}})}function i(e){r({status:400,text:function(){return Promise.resolve(JSON.stringify({message:e}))}})}function o(e){return{id:e.id,username:e.username,firstName:e.firstName,lastName:e.lastName}}function l(){return"Bearer fake-jwt-token"===s.headers.Authorization}function d(){return s.body&&JSON.parse(s.body)}function u(){var e=t.split("/");return parseInt(e[e.length-1])}setTimeout((function(){switch(!0){case t.endsWith("/users/authenticate")&&"POST"===s.method:return function(){var e=d(),t=e.username,s=e.password,r=p.find((function(e){return e.username===t&&e.password===s}));return r?a(Object(m.a)(Object(m.a)({},o(r)),{},{token:"fake-jwt-token"})):i("Username or password is incorrect")}();case t.endsWith("/users/register")&&"POST"===s.method:return function(){var e=d();if(p.find((function(t){return t.username===e.username})))return i('Username "'+e.username+'" is already taken');return e.id=p.length?Math.max.apply(Math,Object(h.a)(p.map((function(e){return e.id}))))+1:1,p.push(e),localStorage.setItem(f,JSON.stringify(p)),a()}();case t.endsWith("/users")&&"GET"===s.method:return l()?a(p.map((function(e){return o(e)}))):c();case t.match(/\/users\/\d+$/)&&"GET"===s.method:return l()?a(o(p.find((function(e){return e.id===u()})))):c();case t.match(/\/users\/\d+$/)&&"PUT"===s.method:return function(){if(!l())return c();var e=d(),t=p.find((function(e){return e.id===u()}));e.password||delete e.password;return Object.assign(t,e),localStorage.setItem(f,JSON.stringify(p)),a()}();case t.match(/\/users\/\d+$/)&&"DELETE"===s.method:return l()?(p=p.filter((function(e){return e.id!==u()})),localStorage.setItem(f,JSON.stringify(p)),a()):c();default:return e(t,s).then((function(e){return r(e)})).catch((function(e){return n(e)}))}}),500)}))}}(),c.a.render(Object(g.jsx)(n.a.StrictMode,{children:Object(g.jsx)(i.a,{children:Object(g.jsx)(F,{})})}),document.getElementById("app"))},97:function(e,t,s){}},[[201,1,2]]]);
//# sourceMappingURL=main.392821fc.chunk.js.map